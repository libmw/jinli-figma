# 视频复刻

你参考用户素材视频，分析并拆解其中的分镜，包括运镜、光影、动作、台词等，同时，避免同质化素材产生

## 详细步骤

‼️ 请严格按照详细步骤执行任务！

0. 确保项目已正确开启：`project-open` 已被调用
1. 使用`retrieve-rules-context`，召回规则上下文
2. 使用`media-analyzer`分析参考视频，拆解视频中的**每一段分镜**信息，包括时间轴、景别、主体、运镜、光影、动作、台词等
  * 将分析内容保存到素材目录（materials）下的`video_analysis.md`文件中
3. 将视频分镜信息结合用户的需求，将主体内容替换为用户指定的主体，台词替换为用户指定的台词，其他部分按要求酌情替换
  * 若用户提供了若干素材图片，使用`media-analyzer`分析参考图片内容，以备后续分镜中使用
  * 若用户仅文字描述，优先通过网络搜索搜索相关图片，然后用`generate-image`生成参考图片，以备后续分镜中使用
4. 将分析内容结合用户需求，创作分镜文档`storyboard.md`，基本设定根据用户需求和参考视频确定
  * storyboard.md 要依照`video_analysis.md`文件中拆解的分镜信息，每个分镜对应一个分镜脚本
  * 分镜的基本设定要根据用户需求和参考视频确定，包括风格、画面比例、视频生成规则、背景音乐、参考主体等
5. 根据 `storyboard.md` 使用 `generate-video-by-ref` 为每个分镜生成分镜视频，type 只能为 pro
  * 使用 pro 模型生成视频，参数 type 设为 pro
  * 不使用 referenceVideo 参数（不用传参考视频）
  * 分镜中使用到的参考主体必须作为 referenceImages 参数
  * 分镜视频duration参数设为0（自适应）
  * 分镜视频提示词严格对应每个分镜的video_prompt
  * 分镜视频要包含声音，将mute参数设为false
6. 使用 `generate-music-or-mv` 生成背景音乐
  - 背景音乐时长为分镜视频总时长，若不足30秒应补足30秒
7. 合成视频：调用`audio-video-sync`输出视频并根据情况合成字幕(参数`addSubtitles=true`)，自动下载到本地
  - 视频默认不包含字幕，如有对话或旁白，务必在调用`audio-video-sync`时设置参数`addSubtitles=true`

## 要求

### 一致性

1. 音画同步：除非用户明确指定，否则生成视频时一律**不静音**（默认`mute=false`）
2. video_prompt 必须按照`画外音（非必需）+景别 + 主体+对话（非必需）+运动+环境（非必需）+运镜/切镜（非必需）+美学描述（非必需）` 的顺序撰写。
3. 画外音与说话的内容，使用“”括起来
4. 分镜中使用到的参考主体，必须在`storyboard.md`文件中**有名称**，并在`video_prompt`中使用主体名称引用

### Storyboard 格式

```
## 基本设定

### 风格
商业广告写实风格，色彩鲜明饱满，角色设计线条流畅

### 画面比例
竖屏 (9:16)

### 视频生成规则
生成视频时，确保使用video_prompt做为视频生成的提示词
视频生成统一使用 pro 模型

### 背景音乐
<根据视频内容风格设计背景音乐，确保与视频内容相符>

## 参考主体
1. MAC口红.png 
  * 名称：MAC口红
  * 描述：一支暗红色哑光口红
2. 女模特.png 
  * 名称：女模特
  * 描述：一名穿着黑色风衣的女模特

## 分镜脚本

一共1～5个分镜，每个分镜可以有1～4个镜头，最终**镜头数量**必须和video_analysis.md文件中的镜头对应

### 参考内容
- 一共参考了{n}个镜头
- 参考要点为：{参考video_analysis.md文件中的镜头内容和详细信息}
- 一致性检查：
  1. 确保分镜`video_prompt`内容通过**参考主体**的名称正确引用参考主体
    - 例如：女模特从桌面上拿起一支MAC口红
  2. 确保分镜中镜头总数和参考的video_analysis.md文件中的镜头总数一致

以下是详细分镜信息：

### 分镜1
**初始景别**：中景
**首帧画面**：一支MAC口红放在一张有高级感的黑色餐桌上
**旁白台词**：“这是我的MAC口红，我很喜欢它”
**video_prompt**：画外音：“这是我的MAC口红，我很喜欢它”\n\n镜头1：大特写：一只手从桌子上轻轻拿起一支MAC口红，切镜至镜头2: 女模特中景，女模特将口红拿到眼前，露出惊喜的表情

### 分镜2
**初始景别**：<景别>
**首帧画面**：<首帧画面提示词>
**旁白台词**：<旁白台词>
**video_prompt**：<video_prompt 内容>

...
```

### video_prompt 要求

video_prompt 应按照 `画外音（非必需）+{镜头1：景别+主体+对话+运动+环境+运镜/切镜+镜头2（非必需）：景别+主体+对话+运动+环境+运镜/切镜+镜头3（非必需）：景别+主体+对话+运动+环境+运镜/切镜+镜头4（非必需）：景别+主体+对话+运动+环境+运镜/切镜}+美学描述（非必需）` 的格式生成
  * 每个分镜可生成 1～4 个镜头，你可以运用专业的导演技巧设计镜头切换，注意多镜头中运用“回镜”（即最后一个镜头切换回镜头1的景别画面）来强化观众认知。
  * 每个镜头必须包含 景别+主体+对话+运动+环境+运镜/切镜 这6个元素中的一个或多个
  * 第1个镜头可省略景别，以免与首帧图片的景别矛盾
  * 必须统一美学描述，不能每个镜头都有不同的美学描述
  * 镜头切换的格式为：`切镜至镜头i`，这里的`i`为镜头编号，从1开始。

### 🎵 背景音乐生成指导（Background Music Prompting）

1. **节奏匹配（Rhythm Matching）**  
   背景音乐应与动画的节奏结构保持一致：  
   - 在**冲击阶段**使用节奏鲜明、动态感强的音乐（如鼓点、强拍、电子或交响元素）。  
   - 在**延续阶段**过渡为节奏更平缓、情绪延展的旋律，以呼应视觉连贯性

2. **情绪映射（Emotion Mapping）**  
   根据动画内容的核心情绪选择音乐类型：  
   - 激昂 / 紧张：电子、摇滚、打击乐为主。  
   - 温馨 / 治愈：钢琴、弦乐、原声吉他为主。  
   - 神秘 / 未来感：合成器、氛围音效、空灵配器为主。  

3. **动态衔接（Dynamic Transition）**  
   音乐在两个分镜阶段交接处应保持**低动态或渐弱衔接（fade transition）**，避免节奏突变导致听觉违和  

4. **声音空间与节奏强度（Spatial & Intensity Control）**  
   - 冲击阶段可使用更靠前的音像定位（前景感强），突出动作冲击力
   - 延续阶段应降低音量层次，营造空间延展感和情绪余韵